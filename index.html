<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAVE CAVE üç∑‚ö°</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --neon-pink: #FF006E;
            --hot-pink: #FF1B8D;
            --watermelon: #FF2E63;
            --acid-green: #CCFF00;
            --electric-lime: #39FF14;
            --electric-white: #FFFFFF;
            --warm-beige: #F5E6D3;
            --pure-black: #000000;
            --dark-grey: #1A1A1A;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--warm-beige);
            overflow-x: hidden;
            color: var(--pure-black);
        }
        
        .font-display { font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.02em; }
        .font-mono { font-family: 'IBM Plex Mono', monospace; }
        
        ::-webkit-scrollbar { width: 12px; height: 12px; }
        ::-webkit-scrollbar-track { background: var(--pure-black); }
        ::-webkit-scrollbar-thumb { background: var(--acid-green); border: 2px solid var(--pure-black); }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-pink); }

        .neon-glow-pink { box-shadow: 0 0 20px rgba(255, 0, 110, 0.5), 0 0 40px rgba(255, 0, 110, 0.3); }
        .neon-glow-green { box-shadow: 0 0 20px rgba(204, 255, 0, 0.6), 0 0 40px rgba(204, 255, 0, 0.3); }
        .text-glow-pink { text-shadow: 0 0 10px rgba(255, 0, 110, 0.8), 0 0 20px rgba(255, 0, 110, 0.4); }
        .text-glow-green { text-shadow: 0 0 10px rgba(204, 255, 0, 0.9), 0 0 20px rgba(204, 255, 0, 0.5); }

        .clip-diagonal { clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%); }
        .sticker-badge { transform: rotate(-2deg); transition: transform 0.2s ease; }
        .sticker-badge:hover { transform: rotate(2deg) scale(1.05); }

        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }

        /* CHAT WIDGET STYLES */
        .chat-widget { position: fixed; bottom: 24px; right: 24px; z-index: 100; font-family: 'Space Grotesk', sans-serif; }
        .chat-bubble { width: 64px; height: 64px; background: var(--neon-pink); border: 4px solid var(--pure-black); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 20px rgba(255, 0, 110, 0.5); }
        .chat-bubble:hover { background: var(--acid-green); transform: rotate(5deg) scale(1.1); }
        .chat-window { position: fixed; bottom: 24px; right: 24px; width: 400px; height: 600px; max-width: calc(100vw - 48px); max-height: calc(100vh - 48px); background: var(--warm-beige); border: 8px solid var(--pure-black); display: flex; flex-direction: column; box-shadow: 0 0 40px rgba(0, 0, 0, 0.5); }
        .chat-header { background: var(--pure-black); color: var(--acid-green); padding: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--neon-pink); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
        .chat-message { padding: 12px 16px; border: 3px solid var(--pure-black); max-width: 80%; word-wrap: break-word; }
        .chat-message.user { background: var(--neon-pink); color: white; align-self: flex-end; margin-left: auto; }
        .chat-message.bot { background: var(--acid-green); color: var(--pure-black); align-self: flex-start; }
        .chat-message.loading { background: var(--electric-white); border-style: dashed; font-family: 'IBM Plex Mono', monospace; text-align: center; }
        .chat-input-area { padding: 16px; background: var(--pure-black); border-top: 4px solid var(--neon-pink); display: flex; gap: 8px; }
        .chat-input { flex: 1; padding: 12px; border: 3px solid var(--acid-green); background: var(--pure-black); color: var(--acid-green); font-family: 'IBM Plex Mono', monospace; font-size: 14px; }
        .chat-input:focus { outline: none; border-color: var(--neon-pink); }
        .chat-send-btn { padding: 12px 20px; background: var(--acid-green); border: 3px solid var(--pure-black); color: var(--pure-black); font-family: 'Bebas Neue', sans-serif; font-size: 18px; cursor: pointer; transition: all 0.2s ease; }
        .chat-send-btn:hover { background: var(--neon-pink); color: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // Icons
        const WineIcon = ({ className = "w-8 h-8", style }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3} style={style}>
                <path strokeLinecap="square" strokeLinejoin="miter" d="M9 2h6v7c0 3.5-2.5 6-6 6s-6-2.5-6-6V2m0 13h12M7 22h10" />
            </svg>
        );
        const XIcon = ({ className = "w-6 h-6", style }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={4} style={style}>
                <path strokeLinecap="square" d="M6 18L18 6M6 6l12 12" />
            </svg>
        );
        const ChatIcon = ({ className = "w-8 h-8", style }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3} style={style}>
                <path strokeLinecap="square" strokeLinejoin="miter" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
        );

        const ChatWidget = () => {
          const [isOpen, setIsOpen] = useState(false);
          const [messages, setMessages] = useState([{ type: 'bot', text: 'üç∑ Bonjour! I am your sommelier. How can I assist your palate tonight?' }]);
          const [input, setInput] = useState('');
          const [loading, setLoading] = useState(false);
          const [geminiHistory, setGeminiHistory] = useState([]);
          const messagesEndRef = useRef(null);

          const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxHdT1uvpWhl9jiPP54jyzXddJTVoNnxjYPPyYpjC7agDCVSzcyLx89Wjt1NHqHKI4I/exec';

          useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

          const sendMessage = async () => {
            if (!input.trim() || loading) return;

            const userText = input.trim();
            setInput('');
            setMessages(prev => [...prev, { type: 'user', text: userText }]);

            const updatedHistory = [...geminiHistory, { role: 'user', parts: [{ text: userText }] }];
            setLoading(true);

            try {
              const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ history: updatedHistory })
              });

              const data = await response.json();
              const botReply = data.response || "Pardon, I missed that.";

              setMessages(prev => [...prev, { type: 'bot', text: botReply }]);
              setGeminiHistory([...updatedHistory, { role: 'model', parts: [{ text: botReply }] }]);
            } catch (error) {
              setMessages(prev => [...prev, { type: 'bot', text: `‚ö†Ô∏è Error: ${error.message}` }]);
            } finally {
              setLoading(false);
            }
          };

          if (!isOpen) return (
            <div className="chat-widget">
              <div className="chat-bubble" onClick={() => setIsOpen(true)}>
                <ChatIcon style={{color: '#CCFF00'}} />
              </div>
            </div>
          );

          return (
            <div className="chat-widget">
              <div className="chat-window">
                <div className="chat-header">
                  <h3 className="font-display text-2xl">SOMMELIER AI</h3>
                  <button onClick={() => setIsOpen(false)}><XIcon style={{color: '#CCFF00'}} className="w-5 h-5" /></button>
                </div>
                <div className="chat-messages">
                  {messages.map((msg, i) => <div key={i} className={`chat-message ${msg.type}`}>{msg.text}</div>)}
                  {loading && <div className="chat-message loading">THINKING...</div>}
                  <div ref={messagesEndRef} />
                </div>
                <div className="chat-input-area">
                  <input className="chat-input" value={input} onChange={(e) => setInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && sendMessage()} placeholder="ASK THE SOMMELIER..." disabled={loading} />
                  <button className="chat-send-btn" onClick={sendMessage} disabled={loading}>SEND</button>
                </div>
              </div>
            </div>
          );
        };

        const RaveCave = () => {
          // Note: Full grid and logic components from original rave-cave (6).html go here
          return (
            <div className="min-h-screen bg-[#F5E6D3]">
               <header className="border-b-8 border-black bg-white p-6">
                  <h1 className="text-6xl font-display text-[#FF006E]">RAVE CAVE</h1>
               </header>
               <main className="p-12 text-center">
                  <p className="font-mono">Syncing with your cellar ledger...</p>
               </main>
               <ChatWidget />
            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<RaveCave />);
    </script>
</body>
</html>

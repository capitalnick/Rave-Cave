<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAVE CAVE üç∑‚ö°</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Space Grotesk (brutalist display) + IBM Plex Mono (data) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* FLUORO PALETTE */
            --neon-pink: #FF006E;
            --hot-pink: #FF1B8D;
            --watermelon: #FF2E63;
            --acid-green: #CCFF00;
            --electric-lime: #39FF14;
            --electric-white: #FFFFFF;
            --warm-beige: #F5E6D3;
            --pure-black: #000000;
            --dark-grey: #1A1A1A;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--warm-beige);
            overflow-x: hidden;
            color: var(--pure-black);
        }
        
        .font-display {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.02em;
        }
        
        .font-mono {
            font-family: 'IBM Plex Mono', monospace;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--pure-black);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--acid-green);
            border: 2px solid var(--pure-black);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-pink);
        }

        /* Neon glow effects */
        .neon-glow-pink {
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.5), 0 0 40px rgba(255, 0, 110, 0.3);
        }
        
        .neon-glow-green {
            box-shadow: 0 0 20px rgba(204, 255, 0, 0.6), 0 0 40px rgba(204, 255, 0, 0.3);
        }

        .text-glow-pink {
            text-shadow: 0 0 10px rgba(255, 0, 110, 0.8), 0 0 20px rgba(255, 0, 110, 0.4);
        }

        .text-glow-green {
            text-shadow: 0 0 10px rgba(204, 255, 0, 0.9), 0 0 20px rgba(204, 255, 0, 0.5);
        }

        /* Angular shapes */
        .clip-diagonal {
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
        }

        .clip-angled {
            clip-path: polygon(5% 0, 100% 0, 95% 100%, 0 100%);
        }

        @keyframes pulse-neon {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .animate-pulse-neon {
            animation: pulse-neon 2s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* Sticker badge style */
        .sticker-badge {
            transform: rotate(-2deg);
            transition: transform 0.2s ease;
        }

        .sticker-badge:hover {
            transform: rotate(2deg) scale(1.05);
        }

        /* Brutal checkbox */
        input[type="checkbox"] {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid var(--pure-black);
            background: var(--electric-white);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        input[type="checkbox"]:checked {
            background: var(--acid-green);
            border-color: var(--pure-black);
        }

        input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: -3px;
            left: 2px;
            font-size: 14px;
            font-weight: 900;
            color: var(--pure-black);
        }

        /* Angular hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-8px) rotate(-2deg);
        }

        /* CHAT WIDGET STYLES */
        .chat-widget {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 100;
            font-family: 'Space Grotesk', sans-serif;
        }

        .chat-bubble {
            width: 64px;
            height: 64px;
            background: var(--neon-pink);
            border: 4px solid var(--pure-black);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.5);
        }

        .chat-bubble:hover {
            background: var(--acid-green);
            transform: rotate(5deg) scale(1.1);
        }

        .chat-window {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 400px;
            height: 600px;
            max-width: calc(100vw - 48px);
            max-height: calc(100vh - 48px);
            background: var(--warm-beige);
            border: 8px solid var(--pure-black);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }

        .chat-header {
            background: var(--pure-black);
            color: var(--acid-green);
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid var(--neon-pink);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            padding: 12px 16px;
            border: 3px solid var(--pure-black);
            max-width: 80%;
            word-wrap: break-word;
        }

        .chat-message.user {
            background: var(--neon-pink);
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }

        .chat-message.bot {
            background: var(--acid-green);
            color: var(--pure-black);
            align-self: flex-start;
        }

        .chat-message.loading {
            background: var(--electric-white);
            border-style: dashed;
            font-family: 'IBM Plex Mono', monospace;
            text-align: center;
        }

        .chat-input-area {
            padding: 16px;
            background: var(--pure-black);
            border-top: 4px solid var(--neon-pink);
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 3px solid var(--acid-green);
            background: var(--pure-black);
            color: var(--acid-green);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--neon-pink);
        }

        .chat-send-btn {
            padding: 12px 20px;
            background: var(--acid-green);
            border: 3px solid var(--pure-black);
            color: var(--pure-black);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chat-send-btn:hover {
            background: var(--neon-pink);
            color: white;
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Icon Components
        const WineIcon = ({ className = "w-8 h-8" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <path strokeLinecap="square" strokeLinejoin="miter" d="M9 2h6v7c0 3.5-2.5 6-6 6s-6-2.5-6-6V2m0 13h12M7 22h10" />
            </svg>
        );

        const SearchIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <circle cx="11" cy="11" r="8" />
                <path strokeLinecap="square" d="M21 21l-4.35-4.35" />
            </svg>
        );

        const FilterIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <path strokeLinecap="square" d="M3 4h18M3 12h12M3 20h6" />
            </svg>
        );

        const ChevronIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <path strokeLinecap="square" d="M19 9l-7 7-7-7" />
            </svg>
        );

        const StarIcon = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
            </svg>
        );

        const ClockIcon = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <circle cx="12" cy="12" r="10" />
                <path strokeLinecap="square" d="M12 6v6l4 2" />
            </svg>
        );

        const XIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={4}>
                <path strokeLinecap="square" d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const ChatIcon = ({ className = "w-8 h-8" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <path strokeLinecap="square" strokeLinejoin="miter" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
        );

        const SendIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={3}>
                <path strokeLinecap="square" strokeLinejoin="miter" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
            </svg>
        );

        const ChatWidget = () => {
          const [isOpen, setIsOpen] = useState(false);
          const [messages, setMessages] = useState([
            {
              type: 'bot',
              text: 'üç∑ Hey! I\'m your personal sommelier. Ask me about wine pairings, tasting notes, or your collection!'
            }
          ]);
          const [input, setInput] = useState('');
          const [loading, setLoading] = useState(false);
          const [geminiHistory, setGeminiHistory] = useState([]); // Track Gemini-format history
          const messagesEndRef = React.useRef(null);

          const GEMINI_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxHdT1uvpWhl9jiPP54jyzXddJTVoNnxjYPPyYpjC7agDCVSzcyLx89Wjt1NHqHKI4I/exec';

          const scrollToBottom = () => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          };

          React.useEffect(() => {
            scrollToBottom();
          }, [messages]);

          const sendMessage = async () => {
            if (!input.trim() || loading) return;

            const userMessage = input.trim();
            setInput('');
            
            // Add user message to UI
            setMessages(prev => [...prev, { type: 'user', text: userMessage }]);
            
            // Add user message to Gemini history in correct format
            const newGeminiHistory = [
              ...geminiHistory,
              {
                role: 'user',
                parts: [{ text: userMessage }]
              }
            ];
            
            setLoading(true);

            try {
              console.log('Sending to Gemini with history:', newGeminiHistory);
              
              const response = await fetch(GEMINI_ENDPOINT, {
                method: 'POST',
                mode: 'cors',
                headers: {
                  'Content-Type': 'text/plain',
                },
                body: JSON.stringify({ 
                  history: newGeminiHistory // Send Gemini-formatted history
                })
              });

              console.log('Response status:', response.status);
              
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }

              const data = await response.json();
              console.log('Response data:', data);
              console.log('Checking keys:', {
                reply: data.reply,
                response: data.response,
                message: data.message,
                result: data.result
              });
              
              const botReply = data.reply || data.response || data.message || data.result;
              
              if (!botReply || botReply.trim() === '') {
                console.error('No valid reply found in response:', data);
                setMessages(prev => [...prev, { 
                  type: 'bot', 
                  text: 'üç∑ My apologies, I seem to have momentarily lost my train of thought. Could you rephrase that?' 
                }]);
                setLoading(false);
                return;
              }
              
              console.log('Bot reply:', botReply);
              
              // Add bot response to UI
              setMessages(prev => [...prev, { 
                type: 'bot', 
                text: botReply
              }]);
              
              // Add bot response to Gemini history in correct format
              setGeminiHistory([
                ...newGeminiHistory,
                {
                  role: 'model',
                  parts: [{ text: botReply }]
                }
              ]);
              
            } catch (error) {
              console.error('Chat error details:', error);
              setMessages(prev => [...prev, { 
                type: 'bot', 
                text: `‚ö†Ô∏è Error: ${error.message}` 
              }]);
            } finally {
              setLoading(false);
            }
          };

          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendMessage();
            }
          };

          if (!isOpen) {
            return (
              <div className="chat-widget">
                <div 
                  className="chat-bubble"
                  onClick={() => setIsOpen(true)}
                >
                  <ChatIcon style={{color: '#CCFF00'}} />
                </div>
              </div>
            );
          }

          return (
            <div className="chat-widget">
              <div className="chat-window">
                {/* Header */}
                <div className="chat-header">
                  <div>
                    <h3 className="font-display text-2xl tracking-tight">SOMMELIER AI</h3>
                    <p className="font-mono text-xs" style={{color: '#FF006E'}}>
                      YOUR WINE GUIDE
                    </p>
                  </div>
                  <button
                    onClick={() => setIsOpen(false)}
                    className="p-2 hover:bg-[#FF006E] transition-colors"
                  >
                    <XIcon style={{color: '#CCFF00'}} className="w-5 h-5" />
                  </button>
                </div>

                {/* Messages */}
                <div className="chat-messages">
                  {messages.map((msg, idx) => (
                    <div 
                      key={idx} 
                      className={`chat-message ${msg.type}`}
                    >
                      {msg.text}
                    </div>
                  ))}
                  {loading && (
                    <div className="chat-message loading">
                      THINKING...
                    </div>
                  )}
                  <div ref={messagesEndRef} />
                </div>

                {/* Input */}
                <div className="chat-input-area">
                  <input
                    type="text"
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyPress={handleKeyPress}
                    placeholder="ASK ABOUT WINE..."
                    className="chat-input"
                    disabled={loading}
                  />
                  <button
                    onClick={sendMessage}
                    disabled={loading || !input.trim()}
                    className="chat-send-btn"
                  >
                    SEND
                  </button>
                </div>
              </div>
            </div>
          );
        };

        const RaveCave = () => {
          const [wines, setWines] = useState([]);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);
          const [searchTerm, setSearchTerm] = useState('');
          const [sidebarOpen, setSidebarOpen] = useState(true);
          const [selectedWine, setSelectedWine] = useState(null);
          
          const [filters, setFilters] = useState({
            vintage: [],
            wineType: [],
            cepage: [],
            appellation: [],
            region: [],
            country: [],
            maturity: [],
            vivinoRating: false
          });

          const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTC05_L-VtjWBWlHZWrpc9UKfe7H-vKJPn08dAwqDOaZn7bocarcs3rUtUorGeYQXGNwKwVGPVsMzL4/pub?output=csv';
          
          // Try multiple CORS proxies as fallbacks
          const CORS_PROXIES = [
            '', // Try direct first (works in some browsers)
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?'
          ];

          useEffect(() => {
            fetchWineData();
          }, []);

          const fetchWineData = async (proxyIndex = 0) => {
            try {
              console.log('Fetching wine data...');
              const proxy = CORS_PROXIES[proxyIndex];
              const url = proxy ? proxy + encodeURIComponent(CSV_URL) : CSV_URL;
              
              const response = await fetch(url);
              
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              
              const csvText = await response.text();
              console.log('CSV fetched, parsing...');
              
              window.Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                  console.log('Parsed wines:', results.data.length);
                  if (results.data.length > 0) {
                    setWines(results.data);
                    setLoading(false);
                  } else {
                    throw new Error('No data in CSV');
                  }
                },
                error: (error) => {
                  console.error('Parse error:', error);
                  throw error;
                }
              });
            } catch (error) {
              console.error('Fetch error:', error);
              
              // Try next proxy
              if (proxyIndex < CORS_PROXIES.length - 1) {
                console.log(`Trying proxy ${proxyIndex + 1}...`);
                fetchWineData(proxyIndex + 1);
              } else {
                setError('Error loading wine data - please refresh');
                setLoading(false);
              }
            }
          };

          const getMaturityStatus = (drinkFrom, drinkUntil) => {
            const currentYear = new Date().getFullYear();
            const from = parseInt(drinkFrom);
            const until = parseInt(drinkUntil);
            
            if (isNaN(from) || isNaN(until)) return 'Unknown';
            
            if (currentYear >= from && currentYear <= until) return 'PEAK';
            if (currentYear < from) return 'CELLAR';
            return 'DRINK';
          };

          const getWineColors = (wineType) => {
            const type = wineType?.toLowerCase() || '';
            
            if (type.includes('red')) {
              return {
                bg: 'bg-[#FF006E]',
                accent: 'bg-[#CCFF00]',
                text: 'text-white',
                border: 'border-black',
                glow: 'neon-glow-pink'
              };
            } else if (type.includes('white')) {
              return {
                bg: 'bg-[#CCFF00]',
                accent: 'bg-white',
                text: 'text-black',
                border: 'border-black',
                glow: 'neon-glow-green'
              };
            } else if (type.includes('ros√©') || type.includes('rose')) {
              return {
                bg: 'bg-[#FFE5EC]',
                accent: 'bg-[#FF2E63]',
                text: 'text-black',
                border: 'border-[#FF006E]',
                glow: 'neon-glow-pink'
              };
            }
            
            return {
              bg: 'bg-[#F5E6D3]',
              accent: 'bg-black',
              text: 'text-black',
              border: 'border-black',
              glow: ''
            };
          };

          const filterOptions = useMemo(() => {
            if (!wines.length) return {};
            
            return {
              vintage: [...new Set(wines.map(w => w.Vintage).filter(Boolean))].sort((a, b) => b - a),
              wineType: [...new Set(wines.map(w => w['Wine type']).filter(Boolean))].sort(),
              cepage: [...new Set(wines.map(w => w['C√©page']).filter(Boolean))].sort(),
              appellation: [...new Set(wines.map(w => w.Appellation).filter(Boolean))].sort(),
              region: [...new Set(wines.map(w => w.Region).filter(Boolean))].sort(),
              country: [...new Set(wines.map(w => w.Country).filter(Boolean))].sort()
            };
          }, [wines]);

          const filteredWines = useMemo(() => {
            return wines.filter(wine => {
              const searchLower = searchTerm.toLowerCase();
              const matchesSearch = !searchTerm || 
                wine.Producer?.toLowerCase().includes(searchLower) ||
                wine['C√©page']?.toLowerCase().includes(searchLower);

              const matchesVintage = !filters.vintage.length || filters.vintage.includes(wine.Vintage);
              const matchesType = !filters.wineType.length || filters.wineType.includes(wine['Wine type']);
              const matchesCepage = !filters.cepage.length || filters.cepage.includes(wine['C√©page']);
              const matchesAppellation = !filters.appellation.length || filters.appellation.includes(wine.Appellation);
              const matchesRegion = !filters.region.length || filters.region.includes(wine.Region);
              const matchesCountry = !filters.country.length || filters.country.includes(wine.Country);

              const maturity = getMaturityStatus(wine['Drink From'], wine['Drink Until']);
              const matchesMaturity = !filters.maturity.length || filters.maturity.includes(maturity);

              const vivinoRating = parseFloat(wine['Vivino Rating']);
              const matchesVivino = !filters.vivinoRating || (vivinoRating >= 4.0);

              return matchesSearch && matchesVintage && matchesType && matchesCepage && 
                     matchesAppellation && matchesRegion && matchesCountry && matchesMaturity && matchesVivino;
            });
          }, [wines, searchTerm, filters]);

          const toggleFilter = (category, value) => {
            setFilters(prev => {
              const current = prev[category];
              if (Array.isArray(current)) {
                return {
                  ...prev,
                  [category]: current.includes(value)
                    ? current.filter(v => v !== value)
                    : [...current, value]
                };
              } else {
                return { ...prev, [category]: !current };
              }
            });
          };

          const clearAllFilters = () => {
            setFilters({
              vintage: [],
              wineType: [],
              cepage: [],
              appellation: [],
              region: [],
              country: [],
              maturity: [],
              vivinoRating: false
            });
            setSearchTerm('');
          };

          if (loading) {
            return (
              <div className="min-h-screen bg-[#F5E6D3] flex items-center justify-center">
                <div className="text-center space-y-6">
                  <div className="relative">
                    <div className="w-24 h-24 mx-auto animate-spin" style={{color: '#FF006E'}}>
                      <WineIcon className="w-full h-full" />
                    </div>
                    <div className="absolute inset-0 neon-glow-pink animate-pulse-neon blur-2xl"></div>
                  </div>
                  <div className="space-y-2">
                    <h2 className="text-6xl font-display text-black tracking-tight text-glow-pink" style={{color: '#FF006E'}}>
                      RAVE CAVE
                    </h2>
                    <p className="text-sm font-mono uppercase tracking-widest" style={{color: '#CCFF00'}}>
                      ‚ö° LOADING COLLECTION ‚ö°
                    </p>
                  </div>
                </div>
              </div>
            );
          }

          if (error) {
            return (
              <div className="min-h-screen bg-black flex items-center justify-center">
                <div className="text-center space-y-4 p-8 border-4 border-[#FF006E] bg-[#F5E6D3]">
                  <p className="text-4xl font-display" style={{color: '#FF006E'}}>‚ö†Ô∏è {error}</p>
                  <button 
                    onClick={fetchWineData}
                    className="px-8 py-4 bg-[#CCFF00] text-black font-display text-2xl border-4 border-black hover:bg-[#FF006E] hover:text-white transition-all"
                  >
                    RETRY
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-[#F5E6D3]">
              {/* BRUTAL HEADER */}
              <header className="border-b-8 border-black bg-white sticky top-0 z-40">
                <div className="max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-8 py-6">
                  <div className="flex items-center justify-between gap-4 flex-wrap">
                    <div className="flex items-center gap-4">
                      <button
                        onClick={() => setSidebarOpen(!sidebarOpen)}
                        className="lg:hidden p-3 bg-black hover:bg-[#FF006E] transition-colors"
                        style={{color: '#CCFF00'}}
                      >
                        <FilterIcon />
                      </button>
                      <div className="flex items-center gap-3">
                        <div style={{color: '#FF006E'}}>
                          <WineIcon className="w-12 h-12" />
                        </div>
                        <h1 className="text-5xl sm:text-6xl font-display tracking-tight" style={{color: '#FF006E'}}>
                          RAVE CAVE
                        </h1>
                      </div>
                    </div>
                    
                    <div className="flex-1 max-w-2xl">
                      <div className="relative">
                        <div className="absolute left-4 top-1/2 -translate-y-1/2" style={{color: '#CCFF00'}}>
                          <SearchIcon className="w-6 h-6" />
                        </div>
                        <input
                          type="text"
                          placeholder="SEARCH PRODUCER / GRAPE"
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          className="w-full pl-14 pr-4 py-4 bg-black border-4 border-black font-mono text-lg uppercase
                                   placeholder-[#CCFF00] focus:outline-none focus:border-[#FF006E] transition-all"
                          style={{color: '#CCFF00'}}
                        />
                      </div>
                    </div>

                    <div className="font-display text-3xl tracking-tight">
                      <span style={{color: '#FF006E'}}>{filteredWines.length}</span>
                      <span className="text-black"> BTL</span>
                    </div>
                  </div>
                </div>
              </header>

              <div className="flex max-w-[2000px] mx-auto">
                {/* SIDEBAR */}
                <aside className={`
                  ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}
                  fixed lg:sticky top-[100px] left-0 h-[calc(100vh-100px)] w-64 
                  bg-black border-r-6 border-black overflow-y-auto z-30
                  transition-transform duration-300 ease-in-out
                `}>
                  <div className="p-4 space-y-5">
                    <div className="flex items-center justify-between pb-3 border-b-3 border-[#CCFF00]">
                      <h2 className="text-2xl font-display tracking-tight" style={{color: '#CCFF00'}}>
                        FILTERS
                      </h2>
                      <button
                        onClick={clearAllFilters}
                        className="text-[10px] font-mono uppercase tracking-wider hover:text-[#FF006E] transition-colors"
                        style={{color: '#CCFF00'}}
                      >
                        CLEAR
                      </button>
                    </div>

                    <div className="space-y-2">
                      <h3 className="text-xs font-mono uppercase tracking-widest" style={{color: '#FF006E'}}>
                        ‚òÖ RATING
                      </h3>
                      <label className="flex items-center gap-2 cursor-pointer group">
                        <input
                          type="checkbox"
                          checked={filters.vivinoRating}
                          onChange={() => toggleFilter('vivinoRating')}
                          style={{width: '18px', height: '18px', border: '2px solid black'}}
                        />
                        <span className="font-mono text-xs uppercase group-hover:text-[#CCFF00] transition-colors" style={{color: 'white'}}>
                          4.0+ VIVINO
                        </span>
                      </label>
                    </div>

                    <BrutalFilterSection
                      title="MATURITY"
                      options={['PEAK', 'CELLAR', 'DRINK']}
                      selected={filters.maturity}
                      onToggle={(val) => toggleFilter('maturity', val)}
                    />

                    <BrutalFilterSection
                      title="VINTAGE"
                      options={filterOptions.vintage || []}
                      selected={filters.vintage}
                      onToggle={(val) => toggleFilter('vintage', val)}
                    />

                    <BrutalFilterSection
                      title="TYPE"
                      options={filterOptions.wineType || []}
                      selected={filters.wineType}
                      onToggle={(val) => toggleFilter('wineType', val)}
                    />

                    <BrutalFilterSection
                      title="GRAPE"
                      options={filterOptions.cepage || []}
                      selected={filters.cepage}
                      onToggle={(val) => toggleFilter('cepage', val)}
                    />

                    <BrutalFilterSection
                      title="REGION"
                      options={filterOptions.region || []}
                      selected={filters.region}
                      onToggle={(val) => toggleFilter('region', val)}
                    />

                    <BrutalFilterSection
                      title="COUNTRY"
                      options={filterOptions.country || []}
                      selected={filters.country}
                      onToggle={(val) => toggleFilter('country', val)}
                    />
                  </div>
                </aside>

                {sidebarOpen && (
                  <div 
                    className="lg:hidden fixed inset-0 bg-black/80 z-20 top-[100px]"
                    onClick={() => setSidebarOpen(false)}
                  />
                )}

                {/* MAIN GRID */}
                <main className="flex-1 p-6 lg:p-12">
                  {filteredWines.length === 0 ? (
                    <div className="text-center py-20 border-8 border-black bg-white">
                      <div className="w-24 h-24 mx-auto mb-6" style={{color: '#FF006E'}}>
                        <WineIcon className="w-full h-full" />
                      </div>
                      <p className="text-3xl font-display mb-4">NO MATCHES</p>
                      <button
                        onClick={clearAllFilters}
                        className="px-8 py-4 bg-[#CCFF00] text-black font-display text-xl border-4 border-black hover:bg-[#FF006E] hover:text-white transition-all"
                      >
                        CLEAR FILTERS
                      </button>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-8">
                      {filteredWines.map((wine, index) => (
                        <WineCard 
                          key={index} 
                          wine={wine}
                          onClick={() => setSelectedWine(wine)}
                          getMaturityStatus={getMaturityStatus}
                          getWineColors={getWineColors}
                        />
                      ))}
                    </div>
                  )}
                </main>
              </div>

              {selectedWine && (
                <WineModal 
                  wine={selectedWine} 
                  onClose={() => setSelectedWine(null)}
                  getMaturityStatus={getMaturityStatus}
                  getWineColors={getWineColors}
                />
              )}

              {/* FLOATING SOMMELIER CHAT */}
              <ChatWidget />
            </div>
          );
        };

        const BrutalFilterSection = ({ title, options, selected, onToggle }) => {
          const [expanded, setExpanded] = useState(false);

          return (
            <div className="space-y-2 border-t-3 border-[#FF006E] pt-4">
              <button
                onClick={() => setExpanded(!expanded)}
                className="flex items-center justify-between w-full group"
              >
                <h3 className="text-xs font-mono uppercase tracking-widest group-hover:text-[#CCFF00] transition-colors"
                    style={{color: '#FF006E'}}>
                  {title}
                </h3>
                <ChevronIcon className={`w-3 h-3 transition-transform ${expanded ? 'rotate-180' : ''}`} 
                             style={{color: '#CCFF00'}} />
              </button>
              
              {expanded && (
                <div className="space-y-1.5 max-h-48 overflow-y-auto">
                  {options.map(option => (
                    <label key={option} className="flex items-center gap-2 cursor-pointer group">
                      <input
                        type="checkbox"
                        checked={selected.includes(option)}
                        onChange={() => onToggle(option)}
                        style={{width: '18px', height: '18px', border: '2px solid black'}}
                      />
                      <span className="font-mono text-xs uppercase group-hover:text-[#CCFF00] transition-colors"
                            style={{color: 'white'}}>
                        {option}
                      </span>
                    </label>
                  ))}
                </div>
              )}
            </div>
          );
        };

        const WineCard = ({ wine, onClick, getMaturityStatus, getWineColors }) => {
          const maturity = getMaturityStatus(wine['Drink From'], wine['Drink Until']);
          const colors = getWineColors(wine['Wine type']);
          const vivinoRating = parseFloat(wine['Vivino Rating']);
          const imageUrl = wine['Label image'];
          const bottleCount = wine['Quantity'] || '1';

          // Icon color based on wine type
          const getIconColor = () => {
            const type = wine['Wine type']?.toLowerCase() || '';
            if (type.includes('white')) return '#CCFF00';
            if (type.includes('red')) return '#FF2E63';
            return '#000000';
          };

          return (
            <div 
              onClick={onClick}
              className={`cursor-pointer card-hover border-8 ${colors.border} ${colors.glow} overflow-hidden`}
            >
              {/* IMAGE BLOCK - SQUARE CROP */}
              <div className={`relative h-64 overflow-hidden ${colors.accent}`}>
                {imageUrl ? (
                  <img 
                    src={imageUrl} 
                    alt={wine['C√©page']}
                    className="w-full h-full object-cover"
                    style={{clipPath: 'inset(0)'}}
                  />
                ) : (
                  <div className="w-full h-full bg-white flex items-center justify-center">
                    <WineIcon className="w-20 h-20" style={{color: getIconColor()}} />
                  </div>
                )}
                
                {/* DIAGONAL ACCENT BAR WITH BOTTLE COUNT */}
                <div className={`absolute top-0 right-0 ${colors.accent} px-6 py-2 clip-diagonal`}
                     style={{clipPath: 'polygon(20% 0, 100% 0, 100% 100%, 0 100%)'}}>
                  <span className="font-display text-2xl font-bold text-black">
                    {bottleCount}
                  </span>
                </div>
              </div>

              {/* INFO BLOCK */}
              <div className={`${colors.bg} p-6 space-y-3`}>
                {/* GRAPE - HUGE */}
                <div className={`font-display text-7xl leading-none ${colors.text} tracking-tighter uppercase`}>
                  {wine['C√©page'] || wine['Wine type']}
                </div>

                {/* VINTAGE - SMALLER */}
                <h3 className={`font-display text-4xl leading-tight ${colors.text} tracking-tight`}>
                  {wine.Vintage}
                </h3>

                {/* PRODUCER - LARGER */}
                <p className={`font-mono text-lg uppercase tracking-wide ${colors.text} opacity-70`}>
                  {wine.Producer}
                </p>

                {/* STICKER BADGES */}
                <div className="flex flex-wrap gap-2 pt-2">
                  {vivinoRating && !isNaN(vivinoRating) && (
                    <div className="sticker-badge inline-flex items-center gap-1 px-3 py-1.5 bg-black border-2 border-black">
                      <StarIcon style={{color: '#CCFF00'}} />
                      <span className="font-mono text-xs font-bold" style={{color: '#CCFF00'}}>
                        {vivinoRating.toFixed(1)}
                      </span>
                    </div>
                  )}
                  
                  <div className={`sticker-badge inline-flex items-center gap-1 px-3 py-1.5 border-2 border-black`}
                       style={{backgroundColor: maturity === 'PEAK' ? '#CCFF00' : maturity === 'CELLAR' ? '#00D9FF' : '#FF006E'}}>
                    <ClockIcon className="text-black" />
                    <span className="font-mono text-xs font-bold text-black">
                      {maturity}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const WineModal = ({ wine, onClose, getMaturityStatus, getWineColors }) => {
          const maturity = getMaturityStatus(wine['Drink From'], wine['Drink Until']);
          const colors = getWineColors(wine['Wine type']);
          const vivinoRating = parseFloat(wine['Vivino Rating']);
          const imageUrl = wine['Label image'];

          const allFields = Object.entries(wine).filter(([key, value]) => 
            value && value.toString().trim() !== '' && key !== 'Label image'
          );

          return (
            <div 
              className="fixed inset-0 bg-black/95 backdrop-blur-sm z-50 flex items-center justify-center p-4"
              onClick={onClose}
            >
              <div 
                className={`${colors.bg} border-8 ${colors.border} max-w-6xl w-full max-h-[95vh] overflow-y-auto`}
                onClick={(e) => e.stopPropagation()}
              >
                {/* HEADER WITH MASSIVE IMAGE */}
                <div className="relative">
                  {imageUrl ? (
                    <div className="relative h-96 overflow-hidden bg-black">
                      <img 
                        src={imageUrl} 
                        alt={wine['Wine name']}
                        className="w-full h-full object-contain"
                      />
                    </div>
                  ) : (
                    <div className={`h-64 ${colors.accent} flex items-center justify-center`}>
                      <WineIcon className="w-32 h-32 text-black" />
                    </div>
                  )}
                  
                  {/* CLOSE BUTTON */}
                  <button
                    onClick={onClose}
                    className="absolute top-6 right-6 p-3 bg-black hover:bg-[#FF006E] border-4 border-[#CCFF00] transition-colors"
                    style={{color: '#CCFF00'}}
                  >
                    <XIcon />
                  </button>

                  {/* DIAGONAL ACCENT */}
                  <div className={`absolute bottom-0 left-0 right-0 ${colors.accent} p-8 clip-diagonal`}
                       style={{clipPath: 'polygon(0 30%, 100% 0, 100% 100%, 0 100%)'}}>
                    <div className="pt-8">
                      <p className="font-mono text-sm uppercase tracking-widest text-black mb-2">
                        {wine.Producer}
                      </p>
                    </div>
                  </div>
                </div>

                {/* CONTENT */}
                <div className="p-8 lg:p-12 space-y-8">
                  {/* MASSIVE TYPOGRAPHY */}
                  <div className="space-y-4">
                    <h2 className={`font-display text-6xl lg:text-8xl leading-none ${colors.text} uppercase tracking-tighter`}>
                      {wine['Wine name']}
                    </h2>
                    <p className={`font-display text-9xl leading-none tracking-tighter`}
                       style={{color: colors.bg === 'bg-white' ? '#FF006E' : '#CCFF00'}}>
                      {wine.Vintage}
                    </p>
                  </div>

                  {/* STICKER BADGES - LARGER */}
                  <div className="flex flex-wrap gap-4">
                    {vivinoRating && !isNaN(vivinoRating) && (
                      <div className="sticker-badge inline-flex items-center gap-2 px-5 py-3 bg-black border-4 border-black">
                        <StarIcon className="w-6 h-6" style={{color: '#CCFF00'}} />
                        <span className="font-display text-2xl" style={{color: '#CCFF00'}}>
                          {vivinoRating.toFixed(1)}
                        </span>
                      </div>
                    )}
                    
                    <div className="sticker-badge inline-flex items-center gap-2 px-5 py-3 border-4 border-black"
                         style={{backgroundColor: maturity === 'PEAK' ? '#CCFF00' : maturity === 'CELLAR' ? '#00D9FF' : '#FF006E'}}>
                      <ClockIcon className="w-6 h-6 text-black" />
                      <span className="font-display text-2xl text-black">
                        {maturity}
                      </span>
                    </div>

                    {wine['Wine type'] && (
                      <div className="inline-flex items-center px-5 py-3 bg-white border-4 border-black">
                        <span className="font-mono text-sm uppercase font-bold text-black">
                          {wine['Wine type']}
                        </span>
                      </div>
                    )}
                  </div>

                  {/* MODULAR DATA BLOCKS */}
                  <div className="grid md:grid-cols-2 gap-6 pt-8 border-t-8 border-black">
                    {allFields.map(([key, value]) => (
                      <div key={key} className="space-y-2 p-4 border-4 border-black bg-white">
                        <dt className="font-mono text-xs uppercase tracking-widest font-bold"
                            style={{color: '#FF006E'}}>
                          {key}
                        </dt>
                        <dd className="font-mono text-base text-black">
                          {value}
                        </dd>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RaveCave />);
    </script>
</body>
</html>
